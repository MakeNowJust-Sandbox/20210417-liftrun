{"version":3,"sources":["index.ts"],"names":[],"mappings":"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","file":"20210417-liftrun.056994ce.js","sourceRoot":"..","sourcesContent":["const app = document.querySelector<HTMLCanvasElement>('#app')!;\nconst width = 1280;\nconst height = 720;\nconst ctx = app.getContext('2d')!;\n\nconst line = (stroke: string, x1: number, y1: number, x2: number, y2: number): void => {\n  ctx.strokeStyle = stroke;\n  ctx.beginPath();\n  ctx.moveTo(x1, y1);\n  ctx.lineTo(x2, y2);\n  ctx.stroke();\n};\n\nconst rect = (stroke: string, x: number, y: number, w: number, h: number): void => {\n  ctx.strokeStyle = stroke;\n  ctx.beginPath();\n  ctx.rect(x, y, w, h);\n  ctx.stroke();\n};\n\nconst rectFill = (fill: string, x: number, y: number, w: number, h: number): void => {\n  ctx.fillStyle = fill;\n  ctx.beginPath();\n  ctx.rect(x, y, w, h);\n  ctx.fill();\n};\n\nconst text = (fill: string, x: number, y: number, text: string, font: string): void => {\n  ctx.font = font;\n  ctx.fillStyle = fill;\n  ctx.fillText(text,x, y);\n};\n\nconst liftW = 50;\nconst liftH = 30;\nconst liftR = 200;\n\nconst boxW = 10;\nconst boxH = 10;\n\nconst LOCALSTORAGE_KEY = 'liftrun-highscore';\nlet high = +(localStorage.getItem(LOCALSTORAGE_KEY) ?? 0);\n\nlet started = false;\nlet t = 0;\nlet forceX = 0;\nlet selfX = 100;\nlet key: null | 'left' | 'right' = null;\nlet boxes: {x: number, y: number}[] = [];\n\nconst main = () => {\n  t += 1;\n  forceX += Math.sqrt(t / 300 + 1) * 2;\n\n  line('#aaa', 0, 420, width, 420);\n  rect('#aaa', selfX - 5 - forceX, 420 - 5, 10, 10);\n\n  for (let x = Math.floor(forceX / 100) * 100; x <= forceX + width; x += 100) {\n    line('#aaa', x - forceX, 420 - 30, x - forceX, 420 + 30);\n    text('#aaa', x - forceX + 5, 420 + 30, `${((x - 100) / 100).toFixed(0)} m`, '18px sans-serif');\n  }\n\n  for (let i = 0; i < 4; i++) {\n    const theta = (selfX + i * 90) / 180 * Math.PI;\n    const x = selfX + liftR * Math.cos(theta) - liftW / 2;\n    const y = 420 + liftR * Math.sin(theta) - liftH / 2;\n    line('#aaa', selfX - forceX, 420, x - forceX + liftW / 2, y + liftH / 2);\n    rect('#000', x - forceX, y, liftW, liftH);\n  }\n\n  let hit = false;\n  for (let i = 0; i < boxes.length; i++) {\n    const box = boxes[i];\n    rectFill('#000', box.x - forceX - boxW/2, box.y - boxH/2, boxW, boxH);\n    for (let i = 0; i < 4; i++) {\n      const theta = (selfX + i * 90) / 180 * Math.PI;\n      const x = selfX + liftR * Math.cos(theta) - liftW / 2;\n      const y = 420 + liftR * Math.sin(theta) - liftH / 2;\n      if (x <= box.x && box.x <= x + liftW && y <= box.y && box.y <= y + liftH) {\n        hit = true;\n      }\n    }\n    if (hit) {\n      break;\n    }\n    if (box.x + boxW < forceX) {\n      boxes.splice(i--, 1);\n      continue;\n    }\n    box.x -= Math.sqrt(t / 300 + 1) * 12;\n  }\n\n  if (hit || selfX < forceX) { // Game over.\n    const score = (selfX - 100) / 100;\n    if (high < score) {\n      high = score;\n      localStorage.setItem(LOCALSTORAGE_KEY, high.toString());\n    }\n    started = false;\n    t = 0;\n    forceX = 0;\n    selfX = 100;\n    key = null;\n    boxes = [];\n  }\n\n  const highText = `HIGH: ${high.toFixed(1)} m`;\n  text('#444', width - highText.length * 16, height - 24, highText, '24px sans-serif');\n\n  if (!started) {\n    text('#000', 200, 200, 'LIFTRUN', '64px sans-serif');\n    text('#000', 200, 300, 'PRESS ← OR → KEY TO START', '64px sans-serif');\n    selfX += Math.sqrt(t / 300 + 1) * 2;\n    if (key) { // Start game.\n      started = true;\n      t = 0;\n      forceX = 0;\n      selfX = 100;\n      boxes = [];\n    }\n    return;\n  }\n\n  const score = (selfX - 100) / 100;\n  text('#444', 12, height - 24, `${score.toFixed(1)} m`, '24px sans-serif');\n\n  if (key === 'left') {\n    selfX -= Math.sqrt(t / 300 + 1) * 2 * 2 * ((1.5 ** -t) + 1);\n  }\n  if (key === 'right') {\n    selfX += Math.sqrt(t / 300 + 1) * 2 * 2 * ((1.5 ** -t) + 1);\n  }\n  selfX = Math.max(forceX, Math.min(forceX + width, selfX));\n\n  if (Math.random() <= 0.01 + Math.sqrt(t / 3000000)) {\n    boxes.push({x: forceX + width, y: (420 - liftR) + Math.random() * liftR * 2 - boxH /2});\n  }\n};\n\napp.addEventListener('keydown', ev => {\n  if (ev.key === 'ArrowLeft') key = 'left';\n  if (ev.key === 'ArrowRight') key = 'right';\n});\n\napp.addEventListener('keyup', () => {\n  key = null;\n});\n\nsetInterval(() => {\n  ctx.clearRect(0, 0, width, height);\n  main();\n}, 1000/30);\n"]}